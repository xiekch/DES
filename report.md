# DES 实验报告

16326109 谢昆成

## 算法原理

DES 是一种典型的块加密方法：它以64位为分组长度，64位一组的明文作为算法的输入，通过一系列复杂的操作，输出同样64位长度的密文。

DES 采用64位密钥，但由于每8位中的最后1位用于奇偶校验，实际有效密钥长度为56位。密钥可以是任意的56位的数，且可随时改变。其中极少量的数被认为是弱密钥，但能容易地避开它们。所有的保密性依赖于密钥。

DES 算法的基本过程是换位和置换。

## 总体结构

### DES的总体结构

![1569976780868](C:\Users\xiekch\AppData\Roaming\Typora\typora-user-images\1569976780868.png)

- 加密过程 $C = E_k(M) = IP^{-1} · W · T_{16} · T_{15} \cdots T_1 · IP(M)$.
  M 为算法输入的64位明文块；
  $E_k$ 描述以K 为密钥的加密函数，由连续的过程复合构成；
  IP 为64位初始置换；
  $T_1, T_2 , …, T_{16}$ 是一系列的迭代变换；
  W 为64位置换，将输入的高32位和低32位交换后输出；
  $IP^{-1}$ 是IP 的逆置换；
  C 为算法输出的64位密文块。
- 解密过程$M = D_k(C) = IP^{-1} · W · T_1 · T_2 \cdots T_{16} · IP (C)$.

加密过程和解密过程算法一致，只是子密钥的调度顺序相反。

### 子密钥的生成算法

![1569978454781](C:\Users\xiekch\AppData\Roaming\Typora\typora-user-images\1569978454781.png)

1. 对K 的56个非校验位实行置换PC-1，得到$C_0D_0$，其中$C_0 ,D_0$分别由PC-1 置换后的前28位和后28位组成。
2. 计算$C_i = LS_i(C_i-1) $和$D_i = LS_i(D_i-1)$
   - 当i =1, 2, 9, 16 时，$LS_i (A)$ 表示将二进制串A 循环左移一个位置；否则循环左移两个位置。
3. 对56位的$C_iD_i$ 实行PC-2 压缩置换，得到48位的$K_i$, i = i+1。
4. 如果已经得到$K_{16}$，密钥调度过程结束；否则转(2)。

### Feistel轮函数

![img](https://gss3.bdstatic.com/-Po3dSag_xI4khGkpoWK1HF6hhy/baike/c0%3Dbaike92%2C5%2C5%2C92%2C30/sign=5a42444fb21bb0519b29bb7a5713b1d1/5882b2b7d0a20cf4c298b6b277094b36acaf9957.jpg)

1. 将长度为32位的串$R_{i-1}$ 作E-扩展，成为48位的串$E(R_{i-1})$；
2. 将$E(R_{i-1})$ 和长度为48位的子密钥$K_i$ 作48位二进制串按位异或运算，$K_i$ 由密钥K 生成；
3. 将(2) 得到的结果平均分成8个分组，每个分组长度6位。各个分组分别经过8个不同的S-盒进行6-4 转换，得到8个长度分别为4位的分组；
4. 将(3) 得到的分组结果顺序连接得到长度为32位的串；
5. 将(4) 的结果经过P-置换，得到的结果作为轮函数$f(R_{i-1}, K_i)$ 的最终32位输出。



## 模块分解

据DES的主体结构，其可以分解成三个大的模块：整体算法框架、子密钥生成和Feistel轮函数。



## 数据结构

我们可以对子密钥定义一个数据结构以保存子密钥集。



## 运行结果



## C语言源代码

在编写程序过程中，遇到了不少坑。分享如下：

- malloc申请内存空间时没有初始化内容，用calloc则可
- strncpy遇到字符`'\0'`会截断拷贝，造成拷贝内容过短，改用memcpy
- char在向右移位时会补符号位，造成错误。改用unsigned char代表一个字节。